{% extends 'auth/header.html'%}
{% block content %}

<!-- Page Content -->
<div class="page-heading header-text">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <h1>Academic Projects Hub</h1>
        <span>Your trusted partner for ready-made and custom projects ‚Äî quality and timely delivery guaranteed.</span>
      </div>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="services py-4">
  <div class="container">
    <div class="project-layout">

      <!-- LEFT: Main Image (Static) -->
      <div class="main-image-section">
        {% if project.files and project.files.main_image %}
        <div class="main-image-box" onclick="openImageModal(0)">
          <img src="{{ url_for('static', filename=project.files.main_image.replace('\\', '/')) }}" id="mainImage"
            alt="{{ project.title }}">
        </div>

        <!-- Thumbnails Slider -->
        {% if project.files.images %}
        <div class="thumbnails-section below-main" id="thumbnailsContainer">
          <div class="thumbnails-label">More Images</div>
          <div class="swiper swiper-thumbnails">
            <div class="swiper-wrapper">
              {% for img in project.files.images %}
              <div class="swiper-slide" onclick="openImageModal({{ loop.index0 }})">
                <img src="{{ url_for('static', filename=project.files.main_image.replace('\\', '/')) }}"
                  alt="Thumbnail">
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
        {% endif %}
        {% endif %}
      </div>

      <!-- CENTER: Gallery & Details -->
      <div class="center-content">
        <!-- Project Details -->
        <div class="details-section">
          <h1 class="project-title">{{ project.title }}</h1>
          {% if project.category %}
          <span class="category-badge">{{ project.category }}</span>
          {% endif %}

          <div class="detail-row">
            <div class="detail-label">Project Type</div>
            <div class="detail-value">{{ project.category or 'Custom Development' }}</div>
          </div>

          {% if project.tech_stack %}
          <div class="detail-row">
            <div class="detail-label">Technologies</div>
            <div class="detail-value">
              <div class="tech-tags">
                {% if project.tech_stack is iterable and project.tech_stack is not string %}
                {% for tech in project.tech_stack %}
                <span class="tech-tag">{{ tech }}</span>
                {% endfor %}
                {% else %}
                <span class="tech-tag">{{ project.tech_stack }}</span>
                {% endif %}
              </div>
            </div>
          </div>
          {% endif %}

          <div class="description-section">
            <div class="section-title">üìã Project Description</div>
            <p class="description-text">{{ project.description }}</p>
          </div>

          <div class="description-section">
            <div class="section-title">‚ú® Key Features</div>
            <p class="description-text">
              ‚Ä¢ Modern and responsive design<br>
              ‚Ä¢ Clean and maintainable code<br>
              ‚Ä¢ Full documentation included<br>
              ‚Ä¢ Ready to deploy
            </p>
          </div>
        </div>
      </div>

      <!-- RIGHT: Order Summary Sidebar -->
      <div class="summary-sidebar">
        <!-- Price Card -->
        {% if project.price %}
        <div class="summary-card">
          <div class="summary-header">üí∞ Price Details</div>
          <div class="summary-content">
            <div class="price-row">
              <div class="price-label">Project Cost</div>
              <div class="price-value">‚Çπ{{ project.price }}</div>
            </div>
            <div class="info-item">
              <div class="info-icon">‚úì</div>
              <div class="info-text">
                <div class="info-title">Source Code Included</div>
                <div class="info-desc">Complete project files</div>
              </div>
            </div>
            <div class="info-item">
              <div class="info-icon">‚úì</div>
              <div class="info-text">
                <div class="info-title">Documentation</div>
                <div class="info-desc">Full setup guide included</div>
              </div>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Project Report Card -->
        {% if project.files.report %}
        <div class="summary-card">
          <div class="summary-header">üìÑ Project Report</div>
          <div class="summary-content">
            <div class="report-preview">
              <iframe src="{{ url_for('static', filename=project.files.report.replace('\\', '/')) }}">
              </iframe>
            </div>
            <a href="{{ url_for('static', filename=project.files.report.replace('\\', '/')) }}" class="download-link"
              download>
              ‚¨áÔ∏è Download Full Report
            </a>
          </div>
        </div>
        {% endif %}

        <!-- Demo Video Card -->
        {% if project.files.demo_video %}
        <div class="summary-card">
          <div class="summary-header">üé• Demo Video</div>
          <div class="summary-content">
            <div class="video-preview"
              onclick="this.querySelector('iframe').src=this.querySelector('iframe').src+'&autoplay=1'; this.querySelector('.video-overlay').style.display='none';">
              <iframe src="{{ project.files.demo_video.replace('watch?v=', 'embed/') }}" allowfullscreen></iframe>
              <div class="video-overlay">
                <div class="play-icon">‚ñ∂</div>
              </div>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Project Info -->
        <div class="summary-card">
          <div class="summary-header">‚ÑπÔ∏è Project Information</div>
          <div class="summary-content">
            <div class="info-item">
              <div class="info-icon">üîí</div>
              <div class="info-text">
                <div class="info-title">Secure Purchase</div>
                <div class="info-desc">100% secure transaction</div>
              </div>
            </div>
            <div class="info-item">
              <div class="info-icon">üí¨</div>
              <div class="info-text">
                <div class="info-title">Support Available</div>
                <div class="info-desc">Post-purchase assistance</div>
              </div>
            </div>
            <div class="info-item">
              <div class="info-icon">‚ö°</div>
              <div class="info-text">
                <div class="info-title">Instant Download</div>
                <div class="info-desc">Get files immediately</div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Image Modal -->
<div id="imageModal" class="image-modal">
  <div class="modal-content-wrapper">
    <span class="modal-close" onclick="closeImageModal()">&times;</span>
    <div class="modal-prev modal-nav" onclick="changeImage(-1)">‚ùÆ</div>
    <img id="modalImage" class="modal-image" src="" alt="Full view">
    <div class="modal-next modal-nav" onclick="changeImage(1)">‚ùØ</div>
    <div class="modal-counter" id="modalCounter">1 / 1</div>
  </div>
</div>

<script>
  let thumbsSwiper;
  let currentImageIndex = 0;
  let allImages = [];

  // Initialize Swiper
  function initSwiper() {
    thumbsSwiper = new Swiper('.swiper-thumbnails', {
      spaceBetween: 10,
      slidesPerView: 'auto',
      freeMode: true,
      loop: true,
      autoplay: {
        delay: 2500,
        disableOnInteraction: false,
      },
      watchSlidesProgress: true
    });
  }

  // Collect all image URLs (only thumbnails, not main image to avoid duplication)
  function collectImages() {
    const thumbnails = document.querySelectorAll('.thumbnails-section.below-main .swiper-slide img');
    thumbnails.forEach(img => {
      allImages.push(img.src);
    });
  }

  // Open modal with specific image
  function openImageModal(index) {
    currentImageIndex = index;
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    const counter = document.getElementById('modalCounter');

    modalImg.src = allImages[currentImageIndex];
    counter.textContent = `${currentImageIndex + 1} / ${allImages.length}`;
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';

    // Stop autoplay when modal opens
    if (thumbsSwiper && thumbsSwiper.autoplay) {
      thumbsSwiper.autoplay.stop();
    }
  }

  // Close modal
  function closeImageModal() {
    const modal = document.getElementById('imageModal');
    modal.classList.remove('active');
    document.body.style.overflow = 'auto';

    // Resume autoplay when modal closes
    if (thumbsSwiper && thumbsSwiper.autoplay) {
      thumbsSwiper.autoplay.start();
    }
  }

  // Navigate images in modal
  function changeImage(direction) {
    currentImageIndex += direction;

    if (currentImageIndex >= allImages.length) {
      currentImageIndex = 0;
    } else if (currentImageIndex < 0) {
      currentImageIndex = allImages.length - 1;
    }

    const modalImg = document.getElementById('modalImage');
    const counter = document.getElementById('modalCounter');

    modalImg.style.opacity = '0';
    setTimeout(() => {
      modalImg.src = allImages[currentImageIndex];
      counter.textContent = `${currentImageIndex + 1} / ${allImages.length}`;
      modalImg.style.opacity = '1';
    }, 150);
  }

  // Keyboard navigation
  document.addEventListener('keydown', function (event) {
    const modal = document.getElementById('imageModal');
    if (modal.classList.contains('active')) {
      if (event.key === 'Escape') {
        closeImageModal();
      } else if (event.key === 'ArrowLeft') {
        changeImage(-1);
      } else if (event.key === 'ArrowRight') {
        changeImage(1);
      }
    }
  });

  // Close modal when clicking outside image
  document.getElementById('imageModal').addEventListener('click', function (e) {
    if (e.target === this) {
      closeImageModal();
    }
  });

  // Stop autoplay on hover, resume on mouse leave
  document.addEventListener('DOMContentLoaded', function () {
    initSwiper();
    collectImages();

    const thumbnailsContainer = document.getElementById('thumbnailsContainer');
    if (thumbnailsContainer && thumbsSwiper) {
      thumbnailsContainer.addEventListener('mouseenter', function () {
        if (thumbsSwiper.autoplay) {
          thumbsSwiper.autoplay.stop();
        }
      });

      thumbnailsContainer.addEventListener('mouseleave', function () {
        if (thumbsSwiper.autoplay) {
          thumbsSwiper.autoplay.start();
        }
      });
    }
  });
</script>

{% endblock %}